# Troubleshooting Navigation Buttons

## Problem: Buttons Not Showing

If the navigation buttons aren't appearing, follow these steps:

### Step 1: Check if JavaScript is Loading

Open your browser's Developer Console (F12) and look for errors. Common issues:

#### Error: "Failed to load resource" or "net::ERR_CONNECTION_REFUSED"
**Cause:** Your dev server isn't running or isn't accessible.

**Solution:**
```bash
# Start your dev server
cd /Users/marcfehr/Sites/tnh-storytelling-sveltekit
npm run dev
# or
yarn dev
```

#### Error: "Mixed Content" or "blocked by CORS policy"
**Cause:** Your Drupal site is using HTTP but trying to load from HTTPS localhost (or vice versa).

**Solutions:**
1. **Match protocols:** If Drupal is on `http://`, change the script URL to:
   ```html
   <script src="http://localhost:5173/styles/drupal/sticky.js" defer></script>
   ```

2. **Use inline script (temporary):** Copy the contents of `sticky-inline.html` and paste it at the **end** of your Drupal body field (after all the article HTML).

### Step 2: Check Console Logs

With the updated JavaScript, you should see console logs like:
```
[Sticky Navigation] Initializing...
[Sticky Navigation] Found 11 scroll anchors: ["start", "first", "second", ...]
[Sticky Navigation] Found 20 navigation containers
[Sticky Navigation] Creating buttons for section start (index 0)
...
[Sticky Navigation] Complete! Created 40 navigation buttons
```

If you see:
- **"No scroll anchors found"** → Your HTML is missing `.scroll-anchor` elements with IDs
- **"Container X could not find associated scroll-anchor"** → Navigation containers aren't properly nested near their sections

### Step 3: Verify HTML Structure

Each section needs:
```html
<p style="height:0;margin:0;padding:0;">
    <a class="scroll-anchor" id="section-name" name="section-name">&nbsp;</a>
</p>
```

And navigation placeholders:
```html
<p class="next-button">
    <!-- Navigation buttons generated by sticky.js -->
</p>
```

### Step 4: Check CSS is Loading

If buttons appear but look unstyled, the CSS isn't loading. Check:
```html
<link href="https://localhost:5173/styles/drupal/sticky.css" rel="stylesheet" type="text/css">
```

Same protocol matching rules apply (http vs https).

## Quick Test: Inline Everything

For immediate testing, use inline versions:

1. **CSS:** Copy `sticky.css` contents into a `<style>` tag at the top
2. **JS:** Copy `sticky-inline.html` contents at the bottom

Once working, switch back to external files for easier maintenance.

## Still Not Working?

Check these:
1. Is jQuery loaded? (Soundcite needs it, but our navigation doesn't)
2. Are there JavaScript errors from other scripts blocking execution?
3. Is Drupal's text format stripping out the `<script>` tags? (Try "Full HTML" format)
4. Open DevTools → Elements tab → Search for "next-button" to verify the HTML is there

## Production Deployment

For production, replace `localhost:5173` with your actual domain:
```html
<link href="https://yourdomain.com/styles/drupal/sticky.css" rel="stylesheet" type="text/css">
<script src="https://yourdomain.com/styles/drupal/sticky.js" defer></script>
```

